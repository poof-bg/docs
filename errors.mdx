---
title: Error Handling
description: "Understanding and handling API errors"
---

When something goes wrong, the Poof API returns a consistent error format with actionable information.

## Error Response Format

```json
{
  "code": "error_code",
  "message": "Human-readable description",
  "details": "Additional context or troubleshooting steps",
  "request_id": "req_abc123xyz"
}
```

| Field | Description |
|-------|-------------|
| `code` | Machine-readable error code for programmatic handling |
| `message` | Brief description of what went wrong |
| `details` | Specific guidance on how to fix the issue |
| `request_id` | Unique ID for this request — include in support tickets |

## Error Codes Reference

### Authentication Errors

<AccordionGroup>
  <Accordion title="401 — authentication_error">
    **Cause:** Missing or invalid API key.
    
    **Solution:**
    - Verify your `x-api-key` header is present
    - Check that your API key is correct and not expired
    - Ensure the key hasn't been revoked
    
    ```bash
    # Correct
    curl -H "x-api-key: poof_your_key" ...
    
    # Wrong (missing header)
    curl ...
    ```
  </Accordion>
  
  <Accordion title="403 — permission_denied">
    **Cause:** Valid API key but insufficient permissions.
    
    **Solution:**
    - Your account may be suspended
    - The API key may have been revoked
    - Contact support at support@poof.bg
  </Accordion>
</AccordionGroup>

### Payment Errors

<AccordionGroup>
  <Accordion title="402 — payment_required">
    **Cause:** You've run out of credits.
    
    **Solution:**
    - Check your balance at [dash.poof.bg](https://dash.poof.bg)
    - Upgrade your plan for more credits
    - Wait for your billing cycle to reset
    - Enable auto-recharge to prevent interruptions
  </Accordion>
</AccordionGroup>

### Rate Limiting

<AccordionGroup>
  <Accordion title="429 — rate_limit_exceeded">
    **Cause:** Too many requests in a short period.
    
    **Solution:**
    - Implement exponential backoff
    - Check the `Retry-After` header for wait time
    - Consider upgrading for higher limits
    
    ```python
    import time
    
    def remove_with_retry(client, image, max_retries=3):
        for attempt in range(max_retries):
            try:
                return client.remove(image)
            except RateLimitError as e:
                if attempt == max_retries - 1:
                    raise
                wait = 2 ** attempt  # 1, 2, 4 seconds
                time.sleep(wait)
    ```
  </Accordion>
</AccordionGroup>

### Validation Errors

<AccordionGroup>
  <Accordion title="400 — validation_error">
    **Cause:** Invalid parameter value.
    
    **Solution:** Check the `details` field for which parameter is wrong.
    
    ```json
    {
      "code": "validation_error",
      "message": "One or more parameters are invalid",
      "details": "Invalid value for 'format'. Expected: png, jpg, webp"
    }
    ```
  </Accordion>
  
  <Accordion title="400 — missing_image">
    **Cause:** No image file in the request.
    
    **Solution:**
    - Use `multipart/form-data` content type
    - Include the image in the `image_file` field
    
    ```bash
    # Correct
    curl -F "image_file=@photo.jpg" ...
    
    # Wrong (using JSON body)
    curl -d '{"image": "..."}' ...
    ```
  </Accordion>
  
  <Accordion title="400 — image_too_large">
    **Cause:** Image exceeds 20MB limit.
    
    **Solution:**
    - Resize or compress the image before uploading
    - Use a smaller size preset in your request
  </Accordion>
</AccordionGroup>

### Server Errors

<AccordionGroup>
  <Accordion title="500 — internal_server_error">
    **Cause:** Something went wrong on our end.
    
    **Solution:**
    - Retry the request after a short delay
    - If persistent, contact support with the `request_id`
  </Accordion>
  
  <Accordion title="502 — upstream_error">
    **Cause:** Processing service temporarily unavailable.
    
    **Solution:**
    - Retry with exponential backoff
    - Use the same `Idempotency-Key` header to avoid duplicate processing
  </Accordion>
</AccordionGroup>

## Best Practices

### 1. Always Check Status Codes

```python
import requests

response = requests.post(
    "https://api.poof.bg/v1/remove",
    headers={"x-api-key": api_key},
    files={"image_file": image}
)

if response.status_code == 200:
    # Success — response body is the image
    with open("result.png", "wb") as f:
        f.write(response.content)
elif response.status_code == 429:
    # Rate limited — wait and retry
    error = response.json()
    print(f"Rate limited. Request ID: {error['request_id']}")
else:
    # Other error
    error = response.json()
    print(f"Error: {error['message']}")
```

### 2. Implement Retries with Backoff

```typescript
async function removeWithRetry(
  poof: Poof,
  image: Buffer,
  maxRetries = 3
): Promise<Buffer> {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      return await poof.remove(image);
    } catch (error) {
      if (error.code === 'rate_limit_exceeded' && attempt < maxRetries - 1) {
        const delay = Math.pow(2, attempt) * 1000;
        await new Promise(r => setTimeout(r, delay));
        continue;
      }
      throw error;
    }
  }
  throw new Error('Max retries exceeded');
}
```

### 3. Log Request IDs

Always log the `request_id` from error responses. This helps our support team quickly identify issues:

```python
except PoofError as e:
    logger.error(f"Poof API error: {e.message}", extra={
        "request_id": e.request_id,
        "code": e.code
    })
```

### 4. Handle Specific Errors

```python
from poof.exceptions import (
    AuthenticationError,
    PaymentRequiredError,
    RateLimitError,
    ValidationError
)

try:
    result = client.remove(image)
except AuthenticationError:
    # Re-authenticate or check API key
    pass
except PaymentRequiredError:
    # Notify admin, pause processing
    pass
except RateLimitError as e:
    # Back off and retry
    pass
except ValidationError as e:
    # Log and skip this image
    pass
```

## Getting Help

If you're stuck:

1. Check the error `details` field for specific guidance
2. Search our [GitHub Issues](https://github.com/poof-bg/poof/issues)
3. Email support@poof.bg with your `request_id`
